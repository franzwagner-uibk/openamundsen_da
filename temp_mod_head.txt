"""openamundsen_da.observer.mod10a1_preprocess

Purpose
- Convert MODIS/Terra MOD10A1 (Collection 6/6.1) HDF files into observation‑ready
  artifacts for the data‑assimilation workflow.

Per scene outputs
- `NDSI_Snow_Cover_YYYYMMDD.tif` (GeoTIFF) — NDSI_Snow_Cover band reprojected to
  the target CRS, optionally clipped to a single AOI.
- `NDSI_Snow_Cover_YYYYMMDD_class.tif` (Byte GeoTIFF) — simple 3‑class product
  encoded as 0=invalid, 1=no snow, 2=snow (threshold on 0..100 NDSI).
- `scf_summary.csv` (season‑level table) — one row per accepted day with
  date, region_id, SCF (0..1), cloud_fraction (0..1), and source filename.

Notes
- Assumes single‑region AOI (exactly one polygon feature) and preprocessed inputs.
- Cloud screening is optional via `--max-cloud-fraction` using value 200 pixels.
- Designed to feed directly into `openamundsen_da.observer.satellite_scf`.
"""

from __future__ import annotations

import argparse
import re
import sys
from dataclasses import dataclass
from datetime import datetime
from pathlib import Path
from typing import Iterable

import geopandas as gpd
import numpy as np
import pandas as pd
from loguru import logger

try:  # GDAL is required for HDF handling
    from osgeo import gdal  # type: ignore
except ImportError as exc:  # pragma: no cover - handled at runtime
    gdal = None  # type: ignore
    _GDAL_IMPORT_ERROR: Exception | None = exc
